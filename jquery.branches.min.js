(function(f){var i,k,l,j,m=[].indexOf||function(a){for(var c=0,b=this.length;c<b;c++)if(c in this&&this[c]===a)return c;return-1};l=function(){var a;return(a=f("<canvas>")[0])&&null!=a.getContext};j={automatic:!0,style:["#000","#000"],width:1.5,truncate:12};f.fn.branches=function(a){var c;if(c=f.data(this,"root"))return c.refresh();c=new i(this);c.init(f.extend({},j,a));return f.data(this,"root",c)};var d=function(a,c){this.parent=c;this.state="preinit";this.$item=f(a);this.$anchor=f("> a",this.$item)}; d.prototype.clear=function(){var a;if(this.canvas)return a=this.canvas.getContext("2d"),a.clearRect(0,0,this.canvas.width,this.canvas.height)};d.prototype.connectTo=function(a,c){var b,g;if(this.canvas)return c&&this.clear(),b=this.canvas.getContext("2d"),b.lineWidth=this.cfg.width,b.strokeStyle=this.cfg.style[+("on"===(g=a.state)||"focused"===g)],b.beginPath(),b.moveTo(this.$anchor.outerWidth(),this.$anchor.position().top+this.$anchor.outerHeight()/2),b.lineTo(this.canvas.width,a.$anchor.position().top+ a.$anchor.outerHeight()/2),b.stroke()};d.prototype.init=function(a){var c,b,g,d,h,e=this;this.cfg=a;if("preinit"===this.state){this.state="initialized";if(this.parent){this.cfg=this.parent.cfg;this.siblings=this.parent.children;if(this.cfg.truncate){g=a="";h=this.$anchor.text().split(" ");c=0;for(b=h.length;c<b;c++){d=h[c];if((g=a+g+d).length>this.cfg.truncate){a+="\u2026";break}a=g;g=" "}this.$anchor.text(a)}this.$item.hover(function(){if("off"===e.state)return e.siblings.invoke("on","blur"),e.focus()}, function(){if("focused"===e.state)return e.off(),e.siblings.invoke("blurred","on")});this.$anchor.click(function(){("on"===e.state?e.children:e.siblings).invoke("off");return e.on()})}else this.cfg.automatic&&(this.$item.addClass("branches"),a=f("> a",c=f("li:not(li.on)",this.$item)),b="border-left-color","none"===a.css(b)&&(b="background-color"),this.cfg.style=[],this.cfg.style.push(a.css(b)),c.addClass("on"),this.cfg.style.push(a.css(b)),c.removeClass("on"),this.cfg.width=a.css("border-left-width")|| j.width,this.cfg.width=parseFloat(this.cfg.width));this.children=new k(f("> ul",this.$item),this);this.children.length&&(l()&&this.parent)&&(this.canvas=f("<canvas>").appendTo(this.$item).attr({height:Math.max(this.siblings.$list.height(),this.children.$list.height()),width:this.siblings.$list.width()}).get(0));return this.children.invoke("init")}};d.prototype.on=function(){if("on"!==this.state)return this.state="on",this.$item.addClass("on"),this.parent&&this.parent.connectTo(this,!0),this.children.$list.show(), this.children.invoke("blurred","on")};d.prototype.off=function(){var a;if("off"!==this.state)return this.parent&&("on"===(a=this.state)||"focused"===a)&&this.parent.clear(),this.state="off",this.$item.removeClass("on"),this.clear(),this.children.$list.hide(),this.children.invoke("off")};d.prototype.focus=function(){if("focused"!==this.state&&(this.state="focused",this.$item.addClass("on"),this.parent))return this.parent.connectTo(this)};d.prototype.blur=function(){if("blurred"!==this.state)return this.state= "blurred",this.$item.removeClass("on"),this.parent&&this.parent.connectTo(this,!0),this.children.invoke("on","blur")};d.prototype.refresh=function(){this[!this.parent||this.$item.hasClass("on")?"on":"off"]();return this.children.invoke("refresh")};i=d;d=function(a,c){var b,g,d,h,e;this.parent=c;this.$list=f(a);e=this.$items=f("> li",this.$list);b=d=0;for(h=e.length;d<h;b=++d)g=e[b],this[b]=new i(g,this.parent);this.length=this.$items.length};d.prototype.invoke=function(a,c){var b,d,f,h,e;1===arguments.length&& (d=[null,a],a=d[0],c=d[1]);a&&(a=[].concat(a));e=[];b=d=0;for(f=this.length;d<f;b=++d)(b=this[b])&&(!a||(h=b.state,0<=m.call(a,h)))?e.push(b[c]()):e.push(void 0);return e};k=d})(jQuery);
